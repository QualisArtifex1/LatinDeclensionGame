<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Latin Declension Drag & Drop Practice</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    :root { --royal-blue: #4169e1; --light-blue: #f5faff; --white: #ffffff; --gray-light: #f0f0f0; --red: #e74c3c; --green: #27ae60; --orange: #e67e22; --blue: #3498db; --pink: #fd79a8; }
    *, *::before, *::after { box-sizing: border-box; }
    body { font-family: 'Cinzel', serif; background: var(--light-blue); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
    h1 { color: var(--royal-blue); text-align: center; margin-bottom: 10px; }
    .panel { background: var(--white); padding: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); width: 90%; max-width: 400px; margin-bottom: 20px; }
    .panel h2 { margin-top: 0; text-align: center; }
    .panel label { display: block; margin: 8px 0; font-size: 1rem; }
    button { font-family: inherit; font-weight: 600; background: var(--royal-blue); color: var(--white); border: none; border-radius: 4px; padding: 10px 20px; cursor: pointer; transition: background .2s; margin: 5px; }
    button:hover { background: #27408B; }
    #timer { font-size: 1.2rem; margin-bottom: 10px; }
    #check-button, #restart-button { margin-bottom: 10px; }
    #current-ending { background: var(--white); border: 2px solid var(--royal-blue); border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); cursor: grab; user-select: none; transition: transform .2s; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; visibility: hidden; }
    .declension-table { width: 90%; max-width: 800px; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    th, td { border: 1px solid #aaa; text-align: center; padding: 8px; min-width: 60px; height: 50px; overflow: hidden; }
    .case-nominative th { background: var(--red); color: #fff; }
    .case-genitive th   { background: var(--green); color: #fff; }
    .case-dative th     { background: var(--orange); color: #000; }
    .case-accusative th { background: var(--blue); color: #fff; }
    .case-ablative th   { background: var(--pink); color: #000; }
    .dropzone.drag-over { background: var(--gray-light); }
  </style>
</head>
<body>
  <h1>Latin Declension Practice</h1>
  <div id="selection-container" class="panel">
    <h2>Select Declensions</h2>
    <form id="selection-form">
      <label><input type="checkbox" name="declension" value="0" checked> 1st Declension</label>
      <label><input type="checkbox" name="declension" value="1" checked> 2nd Declension</label>
      <label><input type="checkbox" name="declension" value="2"> 2nd Declension Neuter</label>
      <label><input type="checkbox" name="declension" value="3" checked> 3rd Declension</label>
      <label><input type="checkbox" name="declension" value="4"> 3rd Declension Neuter</label>
      <label><input type="checkbox" name="declension" value="5"> 4th Declension</label>
      <label><input type="checkbox" name="declension" value="6"> 4th Declension Neuter</label>
      <label><input type="checkbox" name="declension" value="7"> 5th Declension</label>
      <div style="text-align:center; margin-top:10px;"><button type="button" id="selection-start">Start Practice</button></div>
    </form>
  </div>
  <div id="game-container" style="display:none; width:100%; max-width:800px; text-align:center;">
    <div id="timer"></div>
    <button id="check-button">Check Answers</button>
    <button id="restart-button">Restart</button>
    <div id="current-ending" draggable="true"></div>
    <div class="declension-table">
      <table>
        <thead><tr id="table-header"><th>Case</th></tr></thead>
        <tbody id="table-body"></tbody>
      </table>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const declensionLabels = ["1","2","2n","3","3n","4","4n","5"];
      const caseClasses = ['case-nominative','case-genitive','case-dative','case-accusative','case-ablative','case-nominative','case-genitive','case-dative','case-accusative','case-ablative'];
      const caseLabels = ['Nominative','Genitive','Dative','Accusative','Ablative','Nominative-P','Genitive-P','Dative-P','Accusative-P','Ablative-P'];
      const fullCorrect = [["a","us/r","um","*","*","us","u","es"],["ae","i","i","is","is","us","us","ei"],["ae","o","o","i","i","ui","u","ei"],["am","um","um","em","*","um","u","em"],["a","o","o","e","e","u","u","e"],["ae","i","a","es","a","us","ua","es"],["arum","orum","orum","um","um","uum","uum","erum"],["is","is","is","ibus","ibus","ibus","ibus","ebus"],["as","os","a","es","a","us","ua","es"],["is","is","is","ibus","ibus","ibus","ibus","ebus"]];
      let selectedDecls = [], correctAnswers = [], initialPool = [], shuffled = [], elapsed = 0, timerInterval = null;
      const selContainer = document.getElementById('selection-container');
      const gameContainer = document.getElementById('game-container');
      const selStartBtn = document.getElementById('selection-start');
      const timerEl = document.getElementById('timer');
      const currentEl = document.getElementById('current-ending');
      const tableHeader = document.getElementById('table-header');
      const tableBody = document.getElementById('table-body');
      const checkBtn = document.getElementById('check-button');
      const restartBtn = document.getElementById('restart-button');

      selStartBtn.addEventListener('click', () => {
        selectedDecls = Array.from(document.querySelectorAll('input[name="declension"]:checked')).map(b => parseInt(b.value));
        if (!selectedDecls.length) { alert('Select at least one declension'); return; }
        selContainer.style.display='none'; gameContainer.style.display='block'; initialize();
      });
      restartBtn.addEventListener('click', () => { buildTable(); startGame(); });

      function initialize() {
        correctAnswers = fullCorrect.map(r => selectedDecls.map(c => r[c]));
        initialPool = correctAnswers.flat();
        buildTable(); startGame();
      }

      function buildTable() {
        tableHeader.innerHTML='<th>Case</th>';
        selectedDecls.forEach(c => { const th = document.createElement('th'); th.textContent=declensionLabels[c]; tableHeader.appendChild(th); });
        tableBody.innerHTML='';
        correctAnswers.forEach((row, ri) => {
          const tr = document.createElement('tr'); tr.classList.add(caseClasses[ri]);
          const th = document.createElement('th'); th.textContent=caseLabels[ri]; tr.appendChild(th);
          row.forEach((_, ci) => { const td = document.createElement('td'); td.classList.add('dropzone'); td.dataset.row=ri; td.dataset.col=ci; td.addEventListener('dragover', e=>e.preventDefault()); td.addEventListener('drop', handleDrop); tr.appendChild(td); });
          tableBody.appendChild(tr);
        });
      }

      function shuffle(a) { const arr=a.slice(); for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }

      function startGame() {
        shuffled = shuffle(initialPool);
        clearInterval(timerInterval);
        elapsed = 0;
        updateTimer();
        timerInterval = setInterval(() => { elapsed++; updateTimer(); },1000);
        showNext();
      }

      function updateTimer() { const m=Math.floor(elapsed/60), s=elapsed%60; timerEl.textContent=`Time: ${m}m ${s}s`; }

      function showNext() {
        if (!shuffled.length) {
          // no confetti here
          currentEl.style.visibility='hidden';
          return;
        }
        const cell=document.querySelector('td.dropzone'); if(cell){ const rect=cell.getBoundingClientRect(); currentEl.style.width=`${rect.width}px`; currentEl.style.height=`${rect.height}px`; }
        const next = shuffled.shift(); currentEl.textContent=next; currentEl.style.visibility='visible';
      }

      currentEl.addEventListener('dragstart', e => { e.dataTransfer.setData('text/plain',currentEl.textContent); setTimeout(()=>currentEl.style.visibility='hidden',0); });
      currentEl.addEventListener('dragend', e => { if (!e.dataTransfer.dropEffect||e.dataTransfer.dropEffect==='none') currentEl.style.visibility='visible'; });

      function handleDrop(e) {
        e.preventDefault();
        const td = e.currentTarget;
        const old = td.textContent.trim();
        if (old) shuffled.push(old);
        const val = e.dataTransfer.getData('text/plain');
        td.textContent = val;
        showNext();
      }

      function checkAnswers() {
        const placed=[];
        document.querySelectorAll('td.dropzone').forEach(z => {
          const text=z.textContent.trim();
          if (!text) return;
          const r=z.dataset.row, c=z.dataset.col;
          const corr=correctAnswers[r][c].toLowerCase();
          if (text.toLowerCase()===corr) placed.push(text);
          else z.textContent='';
        });
        const remaining=initialPool.slice();
        placed.forEach(val => {
          const idx=remaining.findIndex(item=>item.toLowerCase()===val.toLowerCase());
          if(idx>=0) remaining.splice(idx,1);
        });
        shuffled=shuffle(remaining);
        if (remaining.length===0) {
          clearInterval(timerInterval);
          confetti({particleCount:100,spread:70,origin:{y:0.6}});
        }
        showNext();
      }

      checkBtn.addEventListener('click', checkAnswers);
    });
  </script>
</body>
</html>
